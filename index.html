<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME banco de preguntas ‚Äì Choices Examen Residencia</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">
<style>
:root{
  --bg:#ffffff; --text:#0f172a; --muted:#475569; --soft:#f1f5f9; --line:#e2e8f0; --brand:#2563eb; --brand-dark:#1e40af; --accent:#22c55e; --danger:#ef4444; --card:#ffffff;
  --option-correct: rgba(34,197,94,.9);
  --option-wrong:   rgba(239,68,68,.9);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:var(--bg);color:var(--text);
  animation:fadeIn .5s ease;
  transition: background-color .25s ease, color .25s ease;
}
a{color:inherit;text-decoration:none}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}

button{cursor:pointer;border:1px solid var(--line);border-radius:12px;padding:14px 20px;font-size:16px;font-weight:500;transition:.2s background,.2s transform}
button:hover{transform:translateY(-2px)}
.btn-main{background:var(--brand);color:#fff;width:100%;max-width:360px;margin:8px auto;display:block;text-align:center;border-color:var(--brand)}
.btn-main:hover{background:var(--brand-dark)}
.btn-small{padding:10px 14px;font-size:14px}
.hidden{display:none}

.header{position:sticky;top:0;z-index:10;background:var(--card);box-shadow:0 6px 24px rgba(2,6,23,.08)}
.wrap{max-width:1100px;margin:0 auto;padding:16px}
.brand{display:flex;align-items:center;gap:12px;justify-content:center;padding:14px 0}
.brand h1{margin:0;font-size:clamp(20px,3vw,26px);font-weight:700;color:var(--brand-dark)}

.footer{text-align:center;color:var(--muted);font-size:14px;padding:20px}

.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 6px 24px rgba(2,6,23,.08)}
.accordion{list-style:none;margin:0;padding:0;max-width:760px;margin:auto}
.acc-item{border-bottom:1px solid var(--line);padding:10px 4px}
.acc-header{display:flex;flex-direction:column;cursor:pointer}
.acc-title{font-weight:600;font-size:16px}
.acc-count{font-size:12px;color:var(--muted);margin-top:4px}
.acc-content{padding:10px 0 14px 24px;display:none}
.acc-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:6px}
input[type="number"]{background:#fff;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px 10px;width:110px}

.options{margin-top:12px;display:grid;gap:10px}
.option{border:1px solid var(--line);border-radius:12px;padding:12px;display:flex;gap:10px;align-items:flex-start;background:var(--card);cursor:pointer;transition:.15s border-color,.15s box-shadow}
.option.correct{border-color:var(--option-correct);box-shadow:inset 0 0 0 1px rgba(34,197,94,.35)}
.option.wrong{border-color:var(--option-wrong);box-shadow:inset 0 0 0 1px rgba(239,68,68,.35)}
.explain{margin-top:12px;color:var(--muted);font-size:14px;white-space:pre-wrap}
.nav-row{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}

/* Layout pregunta + sidebar √≠ndice */
.q-layout{display:grid;grid-template-columns: 1fr 220px; gap:18px; align-items:start}
@media(max-width:900px){ .q-layout{grid-template-columns:1fr} }

/* Sidebar √≠ndice */
.sidebar{
  position:sticky; top:82px; align-self:start;
  border:1px solid var(--line); background:var(--card); border-radius:14px; padding:12px;
  box-shadow:0 6px 24px rgba(2,6,23,.08); transition: transform .2s ease, opacity .2s ease;
}
.side-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.side-title{font-weight:600;font-size:14px}
.side-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
.side-btn{
  border:1px solid var(--line); background:var(--soft); border-radius:8px; padding:8px;
  font-size:12px; text-align:center; cursor:pointer; user-select:none;
}
.side-btn.ok{ background:rgba(34,197,94,.25); border-color:#22c55e; color:#22c55e; }
.side-btn.bad{ background:rgba(239,68,68,.25); border-color:#ef4444; color:#ef4444; }
.side-btn.cur{ outline:2px solid var(--brand); background:rgba(37,99,235,.15); }
.side-toggle{border-radius:10px; width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center}
.sidebar.closed{ transform: translateX(14px); opacity:.0; pointer-events:none }

/* Modo oscuro suave */
body[data-theme="dark"]{
  --bg:#1e293b; --text:#e2e8f0; --muted:#cbd5e1; --soft:#0f172a; --line:#334155; --card:#0b1624;
  --brand:#6ea8ff; --brand-dark:#4a7fd6;
  --option-correct: rgba(34,197,94,.9);
  --option-wrong:   rgba(239,68,68,.9);
}

/* Toggle tema */
.theme-toggle{
  position:fixed; right:16px; bottom:16px; z-index:50;
  width:46px; height:46px; border-radius:999px; background:var(--brand); color:#fff; border:1px solid var(--brand);
  display:flex; align-items:center; justify-content:center; box-shadow:0 6px 24px rgba(2,6,23,.18);
}
.theme-toggle:hover{ background:var(--brand-dark) }

.chk-mat input[type="checkbox"] {
  transform: scale(1.2);
  margin-right: 6px;
}
</style>
</head>

<body>
  <div class="header">
    <div class="wrap brand">
      <svg width="26" height="26" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Logo">
        <path d="M12 22 C12 12, 28 10, 32 20 C36 10, 52 12, 52 22 C52 36, 38 42, 32 50 C26 42, 12 36, 12 22 Z" stroke="#B91C1C" stroke-width="2" fill="none" />
      </svg>
      <h1>ME banco de preguntas ‚Äì Choices Examen Residencia</h1>
    </div>
  </div>

  <main class="wrap" id="app"></main>

  <div class="footer">Vos pod√©s ‚ù§Ô∏è</div>

  <button id="themeBtn" class="theme-toggle" title="Cambiar tema">üåô</button>

<script>
/* ---------- Persistencia ---------- */
const LS_BANK="mebank_bank_v6_2", LS_PROGRESS="mebank_prog_v6_2", LS_THEME="mebank_theme";
let BANK=JSON.parse(localStorage.getItem(LS_BANK)||"null")||{
  subjects:[{slug:"infectologia",name:"Infectolog√≠a"},{slug:"obstetricia",name:"Obstetricia"},{slug:"pediatria",name:"Pediatr√≠a"}],
  questions:[
    {id:"OB-001",materia:"obstetricia",enunciado:"Gestante 12 semanas, ¬øqu√© estudio no corresponde al primer control?",opciones:["Grupo y factor Rh","Glucemia","VDRL","Urocultivo 28 sem"],correcta:3,explicacion:"El urocultivo a las 28 semanas no es del primer control."},
    {id:"PE-001",materia:"pediatria",enunciado:"Lactante con bronquiolitis leve, manejo:",opciones:["Broncodilatador","Corticoides","Ox√≠geno seg√∫n SatO2","Antibi√≥ticos"],correcta:2,explicacion:"Soporte con ox√≠geno si SatO2 baja."},
    {id:"IN-001",materia:"infectologia",enunciado:"Var√≥n con fiebre y odinofagia, test r√°pido positivo para estreptococo. Conducta:",opciones:["Macr√≥lido emp√≠rico","Amoxicilina 10 d√≠as","Ceftriaxona IM","No tratar"],correcta:1,explicacion:"Penicilina/Amoxi 10 d√≠as es primera l√≠nea."}
  ]
};
const PROG=JSON.parse(localStorage.getItem(LS_PROGRESS)||"{}");
function saveAll(){ localStorage.setItem(LS_BANK,JSON.stringify(BANK)); localStorage.setItem(LS_PROGRESS,JSON.stringify(PROG)); }

/* ---------- Tema ---------- */
(function initTheme(){
  const saved = localStorage.getItem(LS_THEME) || "light";
  document.body.setAttribute("data-theme", saved);
  document.getElementById("themeBtn").textContent = saved==="dark" ? "‚òÄÔ∏è" : "üåô";
})();
document.getElementById("themeBtn").onclick = ()=>{
  const cur = document.body.getAttribute("data-theme")==="dark" ? "light":"dark";
  document.body.setAttribute("data-theme", cur);
  localStorage.setItem(LS_THEME, cur);
  document.getElementById("themeBtn").textContent = cur==="dark" ? "‚òÄÔ∏è" : "üåô";
};

/* ---------- HOME ---------- */
const app=document.getElementById("app");
function renderHome(){
  app.innerHTML = `
    <div style="text-align:center;animation:fadeIn .5s">
      <button class="btn-main" onclick="renderOld()">Ex√°menes anteriores</button>
      <button class="btn-main" onclick="renderGeneral()">Modo pr√°ctica (Examen general)</button>
      <button class="btn-main" onclick="renderStatsGlobal()">Estad√≠sticas generales</button>
      <button class="btn-main" onclick="renderSubjects()">Choice por materia</button>
      <button class="btn-main" style="background:#1e40af;color:white" onclick="renderExamenGeneralSetup()">Modo Examen ‚Äì Cre√° el tuyo</button>
    </div>
  `;
}
renderHome();

/* ---------- Funciones de muestra ---------- */
function renderOld(){
  app.innerHTML = `<div class="card" style="text-align:center">üìÑ Pr√≥ximamente.<br><br><button class='btn-main' onclick='renderHome()'>Volver</button></div>`;
}
function renderSubjects(){
  app.innerHTML = `<div class='card' style='text-align:center'>Aca ir√°n las materias.<br><br><button class='btn-main' onclick='renderHome()'>Volver</button></div>`;
}
function renderStatsGlobal(){
  app.innerHTML = `<div class='card' style='text-align:center'>Estad√≠sticas globales.<br><br><button class='btn-main' onclick='renderHome()'>Volver</button></div>`;
}
function renderGeneral(){
  app.innerHTML = `<div class='card' style='text-align:center'>Modo pr√°ctica.<br><br><button class='btn-main' onclick='renderHome()'>Volver</button></div>`;
}

/* ---------- NUEVO: Modo Examen ‚Äì Cre√° el tuyo ---------- */
function renderExamenGeneralSetup(){
  const subs = BANK.subjects;
  const counts = subs.map(s=>{
    const total = BANK.questions.filter(q=>q.materia===s.slug).length;
    return {...s, total};
  });
  const totalAll = counts.reduce((a,b)=>a+b.total,0);
  const checks = counts.map(s=>`
    <label class="chk-mat" style="display:block;margin:4px 0;">
      <input type="checkbox" class="mat-check" value="${s.slug}" data-count="${s.total}" checked>
      ${s.name} (${s.total})
    </label>`).join("");

  app.innerHTML = `
    <div class="card" style="max-width:700px;margin:auto;">
      <h2>Modo Examen ‚Äì Cre√° el tuyo</h2>
      <p>Ten√©s <b>${totalAll}</b> preguntas disponibles.</p>
      <div id="matList">${checks}</div>
      <div style="margin-top:10px;">
        <label for="numPreg">N√∫mero de preguntas:</label>
        <input id="numPreg" type="number" min="1" value="${totalAll}" max="${totalAll}" style="width:80px;margin-left:6px;">
      </div>
      <div style="margin-top:20px;display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn-main" onclick="startExamenGeneral()">Comenzar examen</button>
        <button class="btn-small" onclick="renderHome()">‚¨ÖÔ∏è Volver al inicio</button>
      </div>
    </div>
  `;
  document.querySelectorAll('.mat-check').forEach(chk=>{
    chk.addEventListener('change', updateExamenCount);
  });
}
function updateExamenCount(){
  const chks = Array.from(document.querySelectorAll('.mat-check'));
  const total = chks.filter(c=>c.checked).reduce((a,c)=>a+parseInt(c.dataset.count),0);
  const numInput=document.getElementById('numPreg');
  if(!numInput._manual){
    numInput.value=total;
    numInput.max=total;
  }
}
document.addEventListener('input',e=>{
  if(e.target.id==='numPreg') e.target._manual=true;
});
function startExamenGeneral(){
  alert("Arrancar√≠a el examen general üòÑ");
}
</script>
</body>
</html>
