<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME banco de preguntas ‚Äì Choices Examen Residencia</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<meta name="theme-color" content="#ffffff">
<style>
:root {
  --bg:#ffffff;
  --text:#0f172a;
  --muted:#475569;
  --soft:#f1f5f9;
  --line:#e2e8f0;
  --brand:#2563eb;
  --brand-dark:#1e40af;
  --accent:#22c55e;
  --danger:#ef4444;
  --card:#ffffff;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text);animation:fadeIn .6s ease}
a{color:inherit;text-decoration:none}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
button{cursor:pointer;border:1px solid var(--line);border-radius:12px;padding:14px 20px;font-size:16px;font-weight:500;transition:.2s background,.2s transform}
button:hover{background:var(--brand-dark);transform:translateY(-2px)}
.btn-main{background:var(--brand);color:#fff;width:100%;max-width:320px;margin:8px auto;display:block;text-align:center}
.btn-small{padding:10px 14px;font-size:14px}
.hidden{display:none}
.header{position:sticky;top:0;z-index:10;background:var(--card);box-shadow:0 6px 24px rgba(2,6,23,.08)}
.wrap{max-width:900px;margin:0 auto;padding:16px}
.brand{display:flex;align-items:center;gap:12px;justify-content:center;padding:14px 0}
.brand h1{margin:0;font-size:clamp(20px,3vw,26px);font-weight:700;color:var(--brand-dark)}
.footer{text-align:center;color:var(--muted);font-size:14px;padding:20px}
.accordion{list-style:none;margin:0;padding:0;max-width:700px;margin:auto}
.acc-item{border-bottom:1px solid var(--line);padding:10px 4px}
.acc-header{display:flex;flex-direction:column;cursor:pointer}
.acc-title{font-weight:600;font-size:16px}
.acc-count{font-size:12px;color:var(--muted);margin-top:4px}
.acc-content{padding:10px 0 14px 24px;display:none}
.acc-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:6px}
input[type="number"]{background:#fff;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px 10px;width:110px}
.option{border:1px solid var(--line);border-radius:12px;padding:12px;display:flex;gap:10px;align-items:flex-start;background:var(--card);cursor:pointer;transition:.15s border-color,.15s box-shadow}
.option.correct{border-color:rgba(34,197,94,.9);box-shadow:inset 0 0 0 1px rgba(34,197,94,.35)}
.option.wrong{border-color:rgba(239,68,68,.9);box-shadow:inset 0 0 0 1px rgba(239,68,68,.35)}
.explain{margin-top:12px;color:var(--muted);font-size:14px;white-space:pre-wrap}
.nav-row{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
</style>
</head>
<body>
  <div class="header">
    <div class="wrap brand">
      <svg width="26" height="26" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Logo">
        <path d="M12 22 C12 12, 28 10, 32 20 C36 10, 52 12, 52 22 C52 36, 38 42, 32 50 C26 42, 12 36, 12 22 Z" stroke="#B91C1C" stroke-width="2" fill="none" />
      </svg>
      <h1>ME banco de preguntas ‚Äì Choices Examen Residencia</h1>
    </div>
  </div>

  <main class="wrap" id="app"></main>

  <div class="footer">Vos pod√©s ‚ù§Ô∏è</div>

<script>
const LS_BANK="mebank_bank_v6",LS_PROGRESS="mebank_prog_v6";
let BANK=JSON.parse(localStorage.getItem(LS_BANK)||"null")||{
subjects:[{slug:"obstetricia",name:"Obstetricia"},{slug:"pediatria",name:"Pediatr√≠a"}],
questions:[
{id:"OB-001",materia:"obstetricia",enunciado:"Gestante 12 semanas, ¬øqu√© estudio no corresponde al primer control?",opciones:["Grupo y factor Rh","Glucemia","VDRL","Urocultivo 28 sem"],correcta:3,explicacion:"El urocultivo a las 28 semanas no es del primer control."},
{id:"PE-001",materia:"pediatria",enunciado:"Lactante con bronquiolitis leve, manejo:",opciones:["Broncodilatador","Corticoides","Ox√≠geno seg√∫n SatO2","Antibi√≥ticos"],correcta:2,explicacion:"Soporte con ox√≠geno si SatO2 baja."}
]};
const PROG=JSON.parse(localStorage.getItem(LS_PROGRESS)||"{}");
function saveAll(){localStorage.setItem(LS_BANK,JSON.stringify(BANK));localStorage.setItem(LS_PROGRESS,JSON.stringify(PROG));}

const app=document.getElementById("app");
function renderHome(){
app.innerHTML=`
  <div style="text-align:center;animation:fadeIn .5s">
    <button class="btn-main" onclick="renderOld()">Ex√°menes anteriores</button>
    <button class="btn-main" onclick="renderGeneral()">Modo pr√°ctica (Examen general)</button>
    <button class="btn-main" onclick="renderStatsGlobal()">Estad√≠sticas generales</button>
    <button class="btn-main" onclick="renderSubjects()">Choice por materia</button>
  </div>`;
}
renderHome();

function renderOld(){app.innerHTML=`<div class="card" style="text-align:center">üìÑ Esta secci√≥n estar√° disponible pr√≥ximamente.<br><br><button class='btn-main' onclick='renderHome()'>Volver</button></div>`;}
function renderSubjects(){
const subs=[...new Map(BANK.subjects.map(s=>[s.slug,s])).values()].sort((a,b)=>a.name.localeCompare(b.name));
const list=subs.map(s=>{
const count=BANK.questions.filter(q=>q.materia===s.slug).length;
return `<li class='acc-item'>
  <div class='acc-header' onclick='toggleAcc("${s.slug}")'>
    <div class='acc-title'>${s.name}</div>
    <div class='acc-count hidden' id='count-${s.slug}'>${count} preguntas cargadas</div>
  </div>
  <div class='acc-content' id='acc-${s.slug}'>
    <div class='acc-actions'>
      <label class='small'>Desde # <input type='number' id='start-${s.slug}' min='1' value='1'></label>
      <button class='btn-small' onclick='startPractica("${s.slug}")'>Pr√°ctica</button>
      <button class='btn-small' onclick='startRepaso("${s.slug}")'>Repaso</button>
      <button class='btn-small' onclick='showStats("${s.slug}")'>Estad√≠sticas</button>
      <button class='btn-small' onclick='renderHome()'>Volver</button>
    </div>
  </div>
</li>`;}).join("");
app.innerHTML=`<ul class='accordion'>${list}</ul>`;
}
window.toggleAcc=(slug)=>{
const el=document.getElementById(`acc-${slug}`);const cnt=document.getElementById(`count-${slug}`);
const open=el.style.display==="block";document.querySelectorAll(".acc-content").forEach(e=>e.style.display="none");
document.querySelectorAll(".acc-count").forEach(c=>c.classList.add("hidden"));
if(!open){el.style.display="block";cnt.classList.remove("hidden");}
};

function getStart(slug){const v=parseInt(document.getElementById(`start-${slug}`).value||"1",10);return isNaN(v)||v<1?1:v;}
function startPractica(slug){
const qs=BANK.questions.filter(q=>q.materia===slug).sort((a,b)=>a.id.localeCompare(b.id));
const start=getStart(slug);CURRENT={list:qs.slice(start-1),i:0,materia:slug};renderQ();}
function startRepaso(slug){
const prog=PROG[slug]||{};const list=BANK.questions.filter(q=>q.materia===slug&&prog[q.id]?.status==='bad');
if(!list.length){app.innerHTML=`<div class='card'>No hay incorrectas.<br><br><button class='btn-main' onclick='renderSubjects()'>Volver</button></div>`;return;}
CURRENT={list,i:0,materia:slug};renderQ();}
function renderGeneral(){
const pool=[...BANK.questions];pool.sort(()=>Math.random()-0.5);const sel=pool.slice(0,30);
CURRENT={list:sel,i:0,materia:"general"};renderQ();}
function renderQ(){
const q=CURRENT.list[CURRENT.i];if(!q){app.innerHTML=`<div class='card'>Sin preguntas.<br><button class='btn-main' onclick='renderHome()'>Volver</button></div>`;return;}
const prog=PROG[CURRENT.materia]||{};const ans=prog[q.id]?.chosen;
const opts=q.opciones.map((t,i)=>{let cls='';if(ans!=null){if(i===q.correcta)cls='correct';else if(i===ans)cls='wrong';}
return `<label class='option ${cls}' onclick='answer(${i})'><input type='radio' name='opt'> ${String.fromCharCode(97+i)}) ${t}</label>`;}).join('');
const exp=(ans!=null)?`<div class='explain'>${q.explicacion||''}</div>`:'';app.innerHTML=`
  <div class='card'>
  <div><b>${CURRENT.materia.toUpperCase()}</b> ¬∑ ${CURRENT.i+1}/${CURRENT.list.length}</div>
  <div style='margin-top:8px;font-size:18px'>${q.enunciado}</div>
  <div class='options'>${opts}</div>${exp}
  <div class='nav-row'>
    <button class='btn-small' onclick='prevQ()'>Anterior</button>
    <button class='btn-small' onclick='nextQ()'>Siguiente</button>
    <button class='btn-small' onclick='renderHome()'>Inicio</button>
  </div></div>`;}
function answer(i){
const q=CURRENT.list[CURRENT.i];PROG[CURRENT.materia]=PROG[CURRENT.materia]||{};
if(PROG[CURRENT.materia][q.id])return;PROG[CURRENT.materia][q.id]={chosen:i,status:(i===q.correcta?'ok':'bad')};saveAll();renderQ();}
function prevQ(){if(CURRENT.i>0){CURRENT.i--;renderQ();}}
function nextQ(){if(CURRENT.i<CURRENT.list.length-1){CURRENT.i++;renderQ();}}
function showStats(slug){
const total=BANK.questions.filter(q=>q.materia===slug).length;const vals=Object.values(PROG[slug]||{});
const ok=vals.filter(v=>v.status==='ok').length;const bad=vals.filter(v=>v.status==='bad').length;
app.innerHTML=`<div class='card'><h3>${slug.toUpperCase()}</h3>
<p>Total: ${total}</p><p style='color:#16a34a'>‚úî ${ok}</p><p style='color:#ef4444'>‚úñ ${bad}</p>
<div class='nav-row'><button class='btn-small' onclick='renderSubjects()'>Volver</button>
<button class='btn-small' onclick='resetStats("${slug}")'>Reestablecer</button></div></div>`;}
function resetStats(slug){if(confirm(`¬øBorrar estad√≠sticas de ${slug}?`)){delete PROG[slug];saveAll();alert("Reiniciado");showStats(slug);}}
function renderStatsGlobal(){
let total=0,ok=0,bad=0;
for(const m of BANK.subjects){const vals=Object.values(PROG[m.slug]||{});total+=BANK.questions.filter(q=>q.materia===m.slug).length;
ok+=vals.filter(v=>v.status==='ok').length;bad+=vals.filter(v=>v.status==='bad').length;}
app.innerHTML=`<div class='card'><h3>Estad√≠sticas generales</h3>
<p>Total preguntas: ${total}</p><p style='color:#16a34a'>‚úî ${ok}</p><p style='color:#ef4444'>‚úñ ${bad}</p>
<div class='nav-row'><button class='btn-main' onclick='renderHome()'>Volver</button></div></div>`;}
let CURRENT={list:[],i:0,materia:""};
</script>
</body>
</html>
